<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements. See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership. The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License. You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied. See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->

<axisconfig name="AxisJava2.0-HTTP2">
    <!-- Test configuration for HTTP/2 transport -->

    <parameter name="hotdeployment">true</parameter>
    <parameter name="hotupdate">false</parameter>
    <parameter name="enableMTOM">false</parameter>
    <parameter name="enableSwA">false</parameter>

    <parameter name="ConfigContextTimeoutInterval">30</parameter>

    <!-- Transport Receivers (for test server) -->
    <transportReceiver name="http" class="org.apache.axis2.transport.http.SimpleHTTPServer">
        <parameter name="port">8080</parameter>
    </transportReceiver>

    <!-- Transport Senders -->
    <!-- HTTP/1.1 Transport (original) -->
    <transportSender name="http" class="org.apache.axis2.transport.http.impl.httpclient5.HTTPClient5TransportSender">
        <parameter name="PROTOCOL">HTTP/1.1</parameter>
        <parameter name="Transfer-Encoding">chunked</parameter>
        <parameter name="connectionTimeout">30000</parameter>
        <parameter name="soTimeout">60000</parameter>
    </transportSender>

    <!-- HTTP/2 Transport (new independent module) -->
    <transportSender name="h2" class="org.apache.axis2.transport.h2.impl.httpclient5.H2TransportSender">
        <parameter name="PROTOCOL">HTTP/2</parameter>
        <parameter name="HTTPS_ONLY">true</parameter>
        <parameter name="MAX_CONCURRENT_STREAMS">100</parameter>
        <parameter name="INITIAL_WINDOW_SIZE">32768</parameter>
        <parameter name="connectionTimeout">30000</parameter>
        <parameter name="responseTimeout">60000</parameter>

        <!-- HTTP/2 Performance Configuration -->
        <parameter name="MAX_CONNECTIONS_TOTAL">50</parameter>
        <parameter name="MAX_CONNECTIONS_PER_ROUTE">10</parameter>
        <parameter name="SERVER_PUSH_ENABLED">false</parameter>

        <!-- JSON Optimization Settings -->
        <parameter name="JSON_STREAMING_ENABLED">true</parameter>
        <parameter name="JSON_STREAMING_THRESHOLD">10485760</parameter> <!-- 10MB -->
        <parameter name="JSON_BUFFER_SIZE">8192</parameter>
    </transportSender>

    <!-- Message Formatters -->
    <messageFormatters>
        <messageFormatter contentType="application/x-www-form-urlencoded"
                         class="org.apache.axis2.kernel.http.XFormURLEncodedFormatter"/>
        <messageFormatter contentType="multipart/form-data"
                         class="org.apache.axis2.kernel.http.MultipartFormDataFormatter"/>
        <messageFormatter contentType="application/xml"
                         class="org.apache.axis2.kernel.http.ApplicationXMLFormatter"/>
        <messageFormatter contentType="text/xml"
                         class="org.apache.axis2.kernel.http.SOAPMessageFormatter"/>
        <messageFormatter contentType="application/soap+xml"
                         class="org.apache.axis2.kernel.http.SOAPMessageFormatter"/>

        <!-- JSON Message Formatters for HTTP/2 -->
        <messageFormatter contentType="application/json"
                         class="org.apache.axis2.json.gson.JsonFormatter"/>
        <messageFormatter contentType="application/json/badgerfish"
                         class="org.apache.axis2.json.gson.JsonFormatter"/>
        <messageFormatter contentType="text/javascript"
                         class="org.apache.axis2.json.gson.JsonFormatter"/>
    </messageFormatters>

    <!-- Message Builders -->
    <messageBuilders>
        <messageBuilder contentType="application/xml"
                       class="org.apache.axis2.builder.ApplicationXMLBuilder"/>
        <messageBuilder contentType="application/x-www-form-urlencoded"
                       class="org.apache.axis2.builder.XFormURLEncodedBuilder"/>
        <messageBuilder contentType="multipart/form-data"
                       class="org.apache.axis2.builder.MultipartFormDataBuilder"/>

        <!-- JSON Message Builders for HTTP/2 -->
        <messageBuilder contentType="application/json"
                       class="org.apache.axis2.json.gson.JsonBuilder"/>
        <messageBuilder contentType="application/json/badgerfish"
                       class="org.apache.axis2.json.gson.JsonBuilder"/>
        <messageBuilder contentType="text/javascript"
                       class="org.apache.axis2.json.gson.JsonBuilder"/>
    </messageBuilders>

    <!-- Global Modules -->
    <module ref="addressing"/>

    <!-- HTTP/2 Transport Configuration Parameters -->
    <parameter name="axis2.http2.enabled">true</parameter>
    <parameter name="axis2.http2.max.concurrent.streams">100</parameter>
    <parameter name="axis2.http2.initial.window.size">32768</parameter>
    <parameter name="axis2.http2.server.push.enabled">false</parameter>
    <parameter name="axis2.http2.connection.timeout">30000</parameter>
    <parameter name="axis2.http2.response.timeout">60000</parameter>

    <!-- JSON Streaming Configuration -->
    <parameter name="axis2.json.streaming.enabled">true</parameter>
    <parameter name="axis2.json.streaming.buffer.size">8192</parameter>
    <parameter name="axis2.json.streaming.threshold">10485760</parameter> <!-- 10MB -->

    <!-- Memory Management for HTTP/2 -->
    <parameter name="axis2.connection.pool.max.total">50</parameter>
    <parameter name="axis2.connection.pool.max.per.route">10</parameter>
    <parameter name="axis2.request.timeout">30000</parameter>

    <!-- Testing Configuration -->
    <parameter name="testing.http2.enabled">true</parameter>
    <parameter name="testing.large.payload.size">52428800</parameter> <!-- 50MB -->
    <parameter name="testing.performance.baseline">true</parameter>

</axisconfig>
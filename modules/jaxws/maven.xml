<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements. See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership. The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License. You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied. See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
  -->

<!-- $Revision: 1.21 $ $Date: 2004-10-27 20:54:09 +0600 (Wed, 27 Oct 2004) $ -->

<project default="jar"
         xmlns:j="jelly:core" 
         xmlns:u="jelly:util"
         xmlns:maven="jelly:maven"
         xmlns:util="jelly:util"
         xmlns:deploy="deploy"
         xmlns:ant="jelly:ant">

    <preGoal name="itest:compile">
        <u:file var="file" name="${maven.itest.src}"/>
        <j:if test="${!file.exists()}">
            <j:expr value="${context.setVariable('maven.itest.skip', 'true')}"/>
        </j:if>
    </preGoal>
    
	<!-- run the JAXB schema compiler -->
    <preGoal name="test:compile">
        <!--<j:if test="context.getVariable('maven.test.skip') != 'true'}">-->

        <j:set var="compiled.classes.dir" value="target/test-classes"/>
        
    	<!-- Theres got to be a better way to do this -->
        <j:set var="schema.source.dir" value="test-resources/xsd"/>
    	<j:set var="wsdl.source.dir" value="test-resources/wsdl"/>
        <j:set var="schema.output.base.dir" value="target/schema"/>
        <j:set var="schema.generated.src.dir" value="${schema.output.base.dir}/src"/>
        <j:set var="schema.generated.classes.dir" value="${schema.output.base.dir}/classes"/>
        
    	<!-- make the dirs -->
        <mkdir dir="${schema.output.base.dir}"/>
        <mkdir dir="${schema.generated.src.dir}"/>
        <mkdir dir="${schema.generated.classes.dir}"/>

    	<!-- Run JAXB schema compiler with designated schemas -->
        <ant:echo>Generating JAX-B classes from XSDs</ant:echo>    
        
        <ant:echo>Generating java from soap 11</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
        	<jvmarg line="${maven.junit.jvmargs2}"/>
        	<classpath refid="maven.dependency.classpath"/>
        	<classpath location="${compiled.classes.dir}"/>
            <arg line="-d ${schema.generated.src.dir} -quiet  ${schema.source.dir}/soap11.xsd"/>
        </java>
        
    	<ant:echo>Generating java from echo.xsd</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
        	<jvmarg line="${maven.junit.jvmargs2}"/>
        	<classpath refid="maven.dependency.classpath"/>
        	<classpath location="${compiled.classes.dir}"/>
            <arg line="-d ${schema.generated.src.dir} -quiet  ${schema.source.dir}/echo.xsd"/>
        </java>

    	<ant:echo>Generating java from stock1.xsd</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
        	<jvmarg line="${maven.junit.jvmargs2}"/>
        	<classpath refid="maven.dependency.classpath"/>
        	<classpath location="${compiled.classes.dir}"/>
            <arg line="-d ${schema.generated.src.dir} -quiet ${schema.source.dir}/stock1.xsd"/>
        </java>

    	<ant:echo>Generating java from stock2.xsd</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
        	<jvmarg line="${maven.junit.jvmargs2}"/>
        	<classpath refid="maven.dependency.classpath"/>
        	<classpath location="${compiled.classes.dir}"/>
            <arg line="-d ${schema.generated.src.dir} -quiet ${schema.source.dir}/stock2.xsd"/>
        </java>

    	<ant:echo>Generating java from samplemtom.xsd</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
        	<jvmarg line="${maven.junit.jvmargs2}"/>
        	<classpath refid="maven.dependency.classpath"/>
        	<classpath location="${compiled.classes.dir}"/>
            <arg line="-d ${schema.generated.src.dir} -quiet ${schema.source.dir}/samplemtom.xsd"/>
        </java>

    	<ant:echo>Generating java from ProxyDocLitWrapped.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    		<jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -p org.test.proxy.doclitwrapped -quiet -wsdl ${wsdl.source.dir}/ProxyDocLitWrapped.wsdl"/>
    	</java>

    	<ant:echo>Generating java from ProxyDocLitnonWrapped.wsdl</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
			<jvmarg line="${maven.junit.jvmargs2}"/>
			<classpath refid="maven.dependency.classpath"/>
			<classpath location="${compiled.classes.dir}"/>
			<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/ProxyDocLitnonWrapped.wsdl"/>
		</java>
        
    	<ant:echo>Generating java from samplemtomjpeg.wsdl</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
			<jvmarg line="${maven.junit.jvmargs2}"/>
			<classpath refid="maven.dependency.classpath"/>
			<classpath location="${compiled.classes.dir}"/>
			<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/samplemtomjpeg.wsdl"/>
		</java>

    	<ant:echo>Generating java from RPCLit.wsdl</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
			<jvmarg line="${maven.junit.jvmargs2}"/>
			<classpath refid="maven.dependency.classpath"/>
			<classpath location="${compiled.classes.dir}"/>
			<arg line="-d ${schema.generated.src.dir} -p org.test.proxy.rpclit -quiet -wsdl ${wsdl.source.dir}/RPCLit.wsdl"/>
		</java>
    	
		<ant:echo>Generating java from gorilla_dlw.wsdl</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
			<jvmarg line="${maven.junit.jvmargs2}"/>
			<classpath refid="maven.dependency.classpath"/>
			<classpath location="${compiled.classes.dir}"/>
			<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/gorilla_dlw.wsdl"/>
		</java>

       	<ant:echo>Generating java from SOAP12Echo.wsdl</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
   			<jvmarg line="${maven.junit.jvmargs2}"/>
   			<classpath refid="maven.dependency.classpath"/>
   			<classpath location="${compiled.classes.dir}"/>
   			<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/SOAP12Echo.wsdl"/>
   		</java>
    	
    	<ant:echo>Generating java from AddNumbers.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	   	<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/AddNumbers.wsdl"/>
    	</java>
    	<ant:echo>Generating java from AddNumbersHandler.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	   	<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/AddNumbersHandler.wsdl"/>
    	</java>
    	<ant:echo>Generating java from async_doclitwr.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	   	<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/async_doclitwr.wsdl"/>
    	</java>

    	<ant:echo>Generating java from FaultyWebService.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/FaultyWebService.wsdl"/>
    	</java>

    	<ant:echo>Generating java from FaultsService.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/FaultsService.wsdl"/>
    	</java> 

    	<ant:echo>Generating java from jaxbsource</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -p org.test.dispatch.jaxbsource ${schema.source.dir}/jaxbsource.xsd"/>
    	</java>

    	<ant:echo>Generating java from doclit_nonwrap.wsdl for javabean endpoint support</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    		<jvmarg line="${maven.junit.jvmargs2}"/>
    		<classpath refid="maven.dependency.classpath"/>
    		<classpath location="${compiled.classes.dir}"/>
    		<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/doclit_nonwrap.wsdl"/>
		</java>

    	<ant:echo>Generating java from doclitwrap.wsdl for javabean endpoint support</ant:echo>
		<java classname="com.sun.tools.xjc.Driver" fork="true"> 
			<jvmarg line="${maven.junit.jvmargs2}"/>
			<classpath refid="maven.dependency.classpath"/>
			<classpath location="${compiled.classes.dir}"/>
			<arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/doclitwrap.wsdl"/>
		</java>

    	<ant:echo>Generating java from doclitbare.wsdl for javabean endpoint support</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
            <jvmarg line="${maven.junit.jvmargs2}"/>
            <classpath refid="maven.dependency.classpath"/>
            <classpath location="${compiled.classes.dir}"/>
            <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/doclitbare.wsdl"/>
        </java>
        
        <ant:echo>Generating java from greeterTypes.xsd</ant:echo>
        <java classname="com.sun.tools.xjc.Driver" fork="true"> 
            <jvmarg line="${maven.junit.jvmargs2}"/>
            <classpath refid="maven.dependency.classpath"/>
            <classpath location="${compiled.classes.dir}"/>
            <arg line="-d ${schema.generated.src.dir} -quiet ${schema.source.dir}/greeterTypes.xsd"/>
        </java>

    	<ant:echo>Generating java from EchoMessage.wsdl for javabean endpoint support</ant:echo>
   	    <java classname="com.sun.tools.xjc.Driver" fork="true"> 
   	        <jvmarg line="${maven.junit.jvmargs2}"/>
   	        <classpath refid="maven.dependency.classpath"/>
   	        <classpath location="${compiled.classes.dir}"/>
   	        <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/EchoMessage.wsdl"/>
	    </java>

    	<ant:echo>Generating java from resourceinjection.wsdl for javabean endpoint Resource Injection support</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/resourceinjection.wsdl"/>
    	 </java>
    	
    	<ant:echo>Generating java from AnyType.wsdl for javabean endpoint AnyType support</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/AnyType.wsdl"/>
    	 </java>

    	<ant:echo>Generating java from WSDLMultiTests.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/WSDLMultiTests.wsdl"/>
    	 </java>
    	 
    	<ant:echo>Generating java from Polymorphic shapes.wsdl for javabean endpoint support</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/shapes.wsdl"/>
    	</java>
    	
    	<ant:echo>Generating java from SOAPActionTest.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/SOAPActionTest.wsdl"/>
    	</java>
    	
    	<ant:echo>Generating java from rpclitenum.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/rpclitenum.wsdl"/>
    	</java>
    	
    	<ant:echo>Generating java from rpclitstringarray.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/rpclitstringarray.wsdl"/>
    	</java>    	
    	
    	<ant:echo>Generating java from StringList.wsdl</ant:echo>
    	<java classname="com.sun.tools.xjc.Driver" fork="true"> 
    	    <jvmarg line="${maven.junit.jvmargs2}"/>
    	    <classpath refid="maven.dependency.classpath"/>
    	    <classpath location="${compiled.classes.dir}"/>
    	    <arg line="-d ${schema.generated.src.dir} -quiet -wsdl ${wsdl.source.dir}/StringList.wsdl"/>
    	</java>
    	
    	<!-- Compile the generated classes -->
    	<ant:echo>Compiling generated schema</ant:echo>
        <javac destdir="${schema.generated.classes.dir}" srcdir="${schema.generated.src.dir}">
            <classpath refid="maven.dependency.classpath"></classpath>
            <classpath location="${compiled.classes.dir}"></classpath>
        </javac>

        <ant:path id="schema.generated.classes.dir" location="${schema.generated.classes.dir}"/>
        <maven:addPath id="maven.dependency.classpath" refid="schema.generated.classes.dir"/>
        <!--</j:if>-->
    </preGoal>
    
	<postGoal name="test:compile">
		<ant:copy toDir="target/test-classes/services/EchoService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="server/**"/>
			</ant:fileset>
			<ant:fileset dir="test/server">
				<ant:exclude name="**/*.java"/>
			</ant:fileset>
		</ant:copy>
        <!-- ================================================================ -->
        <!--- Provider endpoint Service Samples -->
        <!-- ================================================================ -->
		<ant:copy toDir="target/test-classes/services/BasicAuthSecurityService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/security/server/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/security/server">
				<ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
    			<ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/StringProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/string/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/string">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/StringMessageProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/stringmsg/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/stringmsg">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/SourceProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/source/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/source">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/SourceMessageProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/sourcemsg/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/sourcemsg">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/SoapMessageProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/soapmsg/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/soapmsg">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/JAXBProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/jaxb/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/jaxb">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
			<ant:fileset dir="target/schema/classes">
                <ant:include name="org/test/mtom/**"/>
			</ant:fileset>
		</ant:copy>
        
		<ant:copy toDir="target/test-classes/services/SendImageService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/sample/mtom1/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/mtom1">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
			<ant:fileset dir="target/schema/classes">
                <ant:include name="org/apache/axis2/jaxws/sample/mtom1/**"/>
			</ant:fileset>
		</ant:copy>
        
		<ant:copy toDir="target/test-classes/services/SOAP12Service/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/dispatch/server/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/dispatch/server">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
		</ant:copy>
		
        <!-- ================================================================ -->
        <!--- Proxy endpoint Service Samples -->
        <!-- ================================================================ -->
		<ant:copy toDir="target/test-classes/services/ProxyDocLitWrapped/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/proxy/doclitwrapped/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/proxy/doclitwrapped">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/ProxyDocLitnonWrapped/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/proxy/doclitnonwrapped/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/proxy/doclitnonwrapped">
		        <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
		        <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/RPCLit/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/proxy/rpclit/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/proxy/rpclit">
		        <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
		        <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
        
		<ant:copy toDir="target/test-classes/services/SOAP12EchoService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/proxy/soap12/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/proxy/soap12/server">
		        <ant:include name="META-INF/**"/>
			</ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/BookStoreService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/client/soapaction/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/client/soapaction/server">
		        <ant:include name="META-INF/**"/>
			</ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/gorilla_dlw/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/proxy/gorilla_dlw/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/proxy/gorilla_dlw">
		        <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
		        <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<!-- ================================================================ -->
        <!--- XML HTTP Tests -->
        <!-- ================================================================ -->
        <ant:copy toDir="target/test-classes/services/XPayloadStringProvider/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/xmlhttp/provider/payload/string/*.class"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/xmlhttp/provider/payload/string">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/XMessageStringProvider/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/xmlhttp/provider/message/string/*.class"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/xmlhttp/provider/message/string">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/XPayloadSourceProvider/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/xmlhttp/provider/payload/source/*.class"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/xmlhttp/provider/payload/source">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/XMessageSourceProvider/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/xmlhttp/provider/message/source/*.class"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/xmlhttp/provider/message/source">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/XMessageDataSourceProvider/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/xmlhttp/provider/message/datasource/*.class"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/xmlhttp/provider/message/datasource">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		</ant:copy>
		
		<!-- ================================================================ -->
        <!--- Java Bean Endpoint Samples -->
        <!-- ================================================================ -->
		<ant:copy toDir="target/test-classes/services/WSGenService/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/sample/wsgen/WSGenInterface.class"/>
		    <ant:include name="org/apache/axis2/jaxws/sample/wsgen/WSGenImpl.class"/>
		    <ant:include name="org/apache/axis2/jaxws/sample/wsgen/jaxws/**"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/sample/wsgen">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		</ant:copy>

		<ant:copy toDir="target/test-classes/services/AddressBookService/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/sample/addressbook/**"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/sample/addressbook">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/MtomSampleService/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/sample/mtom/**"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/sample/mtom">
			<ant:include name="META-INF/**"/>
          </ant:fileset>
        </ant:copy>
		
		<ant:copy toDir="target/test-classes/services/DocLitNonWrapService/">
		  <ant:fileset dir="target/test-classes">
		    <ant:include name="org/apache/axis2/jaxws/sample/nonwrap/**"/>
		  </ant:fileset>
		  <ant:fileset dir="test/org/apache/axis2/jaxws/sample/nonwrap">
		    <ant:include name="META-INF/**"/>
		  </ant:fileset>
		  <ant:fileset dir="target/classes">
			 <ant:include name="org/apache/axis2/jaxws/server/**"/>
		  </ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/DocLitWrapService/">
			<ant:fileset dir="target/test-classes">
			   	<ant:include name="org/apache/axis2/jaxws/sample/wrap/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/wrap">
			  	<ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
				<ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/AddNumbersService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/addnumbers/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/addnumbers">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		
		<!--
		  AddNumbersHandlerService is a bit of a special service.  The files refered to by
		  the HandlerChain annotation(s) must live in a place relative to the class or interface
		  that carries the annotation.  maven does not automagically copy non-class file resources,
		  so we have to copy them explicitly to their relevent locations.

		  The real problem, however, is that we don't have good separation of our server-side samples
		  from the client side.  This means we have a mix-mashed classpath we have to deal with.  For
		  this AddNumbersHandler case, it will use the classpath at target/test-classes, not
		  target/test-classes/services/AddNumbersHandlerService, so we need to make sure the
		  files refered to by the HandlerChain annotation(s) are in the classpath location, not
		  the desired server-side location.  We need to fix our test config.
		-->

		<ant:copy toDir="target/test-classes/services/AddNumbersHandlerService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/addnumbershandler/**"/>
			</ant:fileset>
			<!-- copy the AddNumbersHandlers.xml file to the server where it won't be found until we fix our test config. -->
			<ant:fileset dir="test">
			   <ant:include name="org/apache/axis2/jaxws/sample/addnumbershandler/AddNumbersHandlers.xml"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/addnumbershandler">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>

		<!-- delete the impl class so we don't accidentally pick it up from the wrong place in the classpath
		     Although this does not fix the problem of looking in the wrong place for the file refered by @HandlerChain -->
		<ant:delete file="target/test-classes/org/apache/axis2/jaxws/sample/addnumbershandler/AddNumbersHandlerPortTypeImpl.class"/>

		<!-- We have to explicitly copy the xml file refered to by the client interface HandlerChain annotation -->
		<ant:copy toDir="target/test-classes/">
			<ant:fileset dir="test">
			   <ant:include name="org/apache/axis2/jaxws/sample/addnumbershandler/AddNumbersClientHandlers.xml"/>
			</ant:fileset>
		</ant:copy>

		<ant:copy toDir="target/test-classes/">
			<ant:fileset dir="test">
			   <ant:include name="org/apache/axis2/jaxws/sample/addnumbershandler/AddNumbersHandlers.xml"/>
			</ant:fileset>
		</ant:copy>
		

		<ant:copy toDir="target/test-classes/services/GreeterService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/dlwmin/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/dlwmin">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/AsyncService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/parallelasync/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/parallelasync/server">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/FaultyWebServiceService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/faults/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/faults">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/FaultsService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/faultsservice/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/faultsservice">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/BareDocLitService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/doclitbare/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/doclitbare">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/BareDocLitMinService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/sample/doclitbaremin/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/sample/doclitbaremin">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/EchoMessageService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/nonanonymous/complextype/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/nonanonymous/complextype">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/ResourceInjectionService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/resourceinjection/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/resourceinjection">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/AnyTypeMessageService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/anytype/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/anytype">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		
		<ant:copy toDir="target/test-classes/services/PolymorphicShapeService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/polymorphic/shape/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/polymorphic/shape">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>	
		
		<ant:copy toDir="target/test-classes/services/RPCLitEnumService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/rpclit/enumtype/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/rpclit/enumtype">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>	
		<ant:copy toDir="target/test-classes/services/StringListService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/stringlist//**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/stringlist">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>	
		<ant:copy toDir="target/test-classes/services/RPCLitStringArrayService/">
			<ant:fileset dir="target/test-classes">
			   <ant:include name="org/apache/axis2/jaxws/rpclit/stringarray/**"/>
			   <ant:include name="org/test/rpclit/stringarray/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/rpclit/stringarray/">
			   <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
			   <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>	

	</postGoal>

    <!-- Create the API and Impl jars --> 
    <postGoal name="jar">
        <jar destfile="target/jaxws-api-${jaxws.version}.jar">
            <ant:fileset dir="target/classes">
            	<ant:exclude name="com/ibm/webservices/**"/>
            </ant:fileset>
        </jar>
    	<jar destfile="target/jaxws-impl-${jaxws.version}.jar">
    	    <ant:fileset dir="target/classes">
                <ant:exclude name="javax/**"/>
            </ant:fileset>
    	</jar>
        <ant:copy toDir="${maven.repo.local}/jaxws/jars">
            <ant:fileset file="target/jaxws-impl-${jaxws.version}.jar"/>
        	<ant:fileset file="target/jaxws-api-${jaxws.version}.jar"/>
        </ant:copy>
    </postGoal>

    <goal name="jar">
        <attainGoal name="jar:install"/>
    </goal>

    <goal name="release" prereqs="dist-bin,dist-src">
    </goal>

    <goal name="dist-bin" prereqs="jar">

        <ant:echo>+----------------------------------------------</ant:echo>
        <ant:echo>| Creating: JAXWS Binary Distribution</ant:echo>
        <ant:echo>+----------------------------------------------</ant:echo>


        <property name="dist" value="target/dist/temp"/>

        <mkdir dir="${dist}"/>
        <mkdir dir="${dist}/apidocs"/>
        <mkdir dir="${dist}/build"/>
        <!--<mkdir dir="${dist}/docs"/>-->
        <mkdir dir="${dist}/lib"/>

        <!--copy dependent jars-->
        <maven:reactor basedir="${basedir}"
                       postProcessing="true"
                       includes="project.xml"
                       banner="Executing (${goals}):"
                       ignoreFailures="false"/>
        <j:forEach var="x" items="${reactorProjects}">
            <ant:echo message="Copying ${x} to ${dist}"/>
            <deploy:copy-deps todir="${dist}/lib"
                              projectDescriptor="${x.getFile()}"/>
        </j:forEach>
        <ant:delete file="${dist}/lib/xmlunit-${xmlunit.version}.jar"/>

        <!--Add the licenses of jars-->
        <ant:copy toDir="${dist}/lib">
            <ant:fileset dir="legal"/>
        </ant:copy>

        <!--add api docs-->

        <ant:javadoc packagenames="org.apache.jaxws.*"
                     defaultexcludes="yes"
                     destdir="${dist}/apidocs"
                     author="true"
                     breakiterator="true"
                     version="true"
                     use="true"
                     windowtitle="JAXWS API">
            <ant:arg
                    line="-J-Dhttp.proxy.port=${maven.proxy.port} -J-Dhttp.proxy.host=${maven.proxy.host}"/>
            <ant:sourcepath>
                <ant:pathelement location="src"/>
            </ant:sourcepath>
            <ant:classpath>
                <ant:fileset dir="${dist}/lib">
                    <ant:include name="*.jar"/>
                </ant:fileset>
            </ant:classpath>
        </ant:javadoc>

        <!--add jars-->
        <ant:copy toDir="${dist}/build">
            <ant:fileset file="target/jaxws-api-${jaxws.version}.jar"/>
            <ant:fileset file="target/jaxws-impl-${jaxws.version}.jar"/>
        </ant:copy>

        <!--add documents-->
        <ant:copy toDir="${dist}/docs">
            <ant:fileset dir="xdocs">
                <ant:exclude name="**/.svn/**"/>
            </ant:fileset>
        </ant:copy>

        <!--copy release notes, etc-->
        <ant:copy toDir="${dist}">
            <ant:fileset file="RELEASE-NOTE.txt"/>
            <ant:fileset file="README.txt"/>
            <ant:fileset file="NOTICE.txt"/>
            <ant:fileset file="LICENSE.txt"/>
        </ant:copy>


        <!--create the zip-->
        <ant:zip file="target/dist/jaxws-${jaxws.version}-bin.zip">
            <ant:fileset dir="${dist}/"/>
        </ant:zip>

        <ant:delete dir="${dist}"/>

    </goal>

    <goal name="dist-src" prereqs="jar">

        <ant:echo>+----------------------------------------------</ant:echo>
        <ant:echo>| Creating: JAXWS Source Distribution</ant:echo>
        <ant:echo>+----------------------------------------------</ant:echo>

        <ant:property name="${dist}" value="target/dist/temp"/>

        <ant:copy toDir="${dist}">
            <ant:fileset dir=".">
                <ant:exclude name="**/.svn/**"/>
                <ant:include name="**/src/**"/>
                <ant:include name="**/test/**"/>
            </ant:fileset>
        </ant:copy>

        <!-- Copy the master maven files for the standard src distro -->
        <ant:copy toDir="${dist}">
            <ant:fileset file="maven.xml"/>
            <ant:fileset file="project.xml"/>
            <ant:fileset file="project.properties"/>
            <ant:fileset file="RELEASE-NOTE.txt"/>
            <ant:fileset file="NOTICE.txt"/>
            <ant:fileset file="LICENSE.txt"/>
        </ant:copy>

        <ant:zip file="target/dist/jaxws-${jaxws.version}-src.zip">
            <ant:fileset dir="${dist}/"/>
        </ant:zip>
        <ant:delete dir="${dist}"/>
    </goal>

    <goal name="javadocs">

        <mkdir dir="target/apidocs"/>

        <ant:javadoc packagenames="org.apache.jaxws.*"
                     defaultexcludes="yes"
                     destdir="target/apidocs"
                     author="true"
                     breakiterator="true"
                     version="true"
                     use="true"
                     windowtitle="JAXWS API">
            <ant:arg
                    line="-J-Dhttp.proxy.port=${maven.proxy.port} -J-Dhttp.proxy.host=${maven.proxy.host}"/>
            <ant:sourcepath>
                <ant:pathelement location="src"/>
            </ant:sourcepath>
        </ant:javadoc>
    </goal>
</project>

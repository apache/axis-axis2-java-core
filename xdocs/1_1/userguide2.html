<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
      "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <title>Axis2 User's Guide</title>
</head>

<body lang="en-US" dir="ltr">
<h4><a name="Axis2_User's_Guide">Axis2 User's Guide</a></h4>

<p><i>User Feedback: <a
href="mailto:axis-user@ws.apache.org">axis-user@ws.apache.org</a></i>. Prefix
subject with [Axis2]. To subscribe to mailing list see <a
href="http://ws.apache.org/axis2/mail-lists.html">here.</a></p>

<p align="right">Pages: <a href="userguide.html">Content</a>, <a
href="userguide1.html">1</a>, <b>2</b>, <a href="userguide3.html">3</a>, <a
href="userguide4.html">4</a>, <a href="userguide5.html">5</a></p>

<h2><a name="Web_Services_Using_Axis2">Web Services Using Axis2</a></h2>
<p> In this section, we will learn how to write and deploy web services using Axis2. All
the samples mentioned are located in the <b>"samples\userguide\src"</b> 
directory of the binary distribution.</p>

<h3><a name="Getting_started">Getting Started</a></h3>
<p>Please deploy axis2.war in your servlet container and ensure that it works fine. 
Please refer to the <a
href="installationguide.html" target="_blank">Installation Guide</a> for instructions.
</p>
<p>Users can use either of the following two ways to write Web services using Axis2.
</p>
<ol>
  <li><a href="#Writing_Web_Services_Using Axis2's_Primary_APIs">Use Axis2's
    primary interfaces (APIs) and implement the business logic.</a></li>
  <li><p><a href="#Writing_Web_Services_by_Code_Generating_Skeleton">Start
    from the WSDL -&gt;Code generate the Skeleton -&gt;Implement the Business
    Logic.</a></p> 
  </li>
</ol>

<p>The complete code for this example Web service (MyService) can be found in the
"Axis2Home/samples/userguide/src" directory under "userguide/example1"
package. </p>


<h3><a name="Writing_Web_Services_Using Axis2's_Primary_APIs">1. Writing Web
Services Using Axis2's Primary APIs</a></h3>
In our example, the web service will have two operations.
<pre>public void ping(OMElement element){} //IN-ONLY operation, just accepts the OMElement and does some processing.
public OMElement echo(OMElement element){}//IN-OUT operation, accepts an OMElement and  
                                          // sends back the same again </pre> 
<h4><a name="How_to_write_the_Web_Service_">How to write a Web
Service?</a></h4>
Writing a new Web service with Axis2 involves four steps:
<ol>
  <li><p style="margin-bottom: 0in">Write the Implementation Class</p>
  </li>
  <li><p style="margin-bottom: 0in">Write a services.xml file to explain the
    Web service</p>
  </li>
  <li><p style="margin-bottom: 0in">Create a *.aar archive (Axis Archive) for
    the Web service</p>
  </li>
  <li><p style="margin-bottom: 0in">Deploy the Web service</p>
  </li>
</ol>

<h4><a name="Step1_:Write_the_Implementation_Class">Step1 :Write the
Implementation Class</a></h4>

<p>An implementation class has the business logic for the Web
service and implements the operations provided by the Web service.
Unless you have data binding, the signature of the methods can have only one
parameter of type OMElement.</p>
<pre>public class MyService{
    public void ping(OMElement element){
        // Business Logic     
        ......
    }
    public OMElement echo(OMElement element){
     ......
    }
}</pre>



<h4><a name="Step2_:Write_the_services_xml_file">Step2 :Write the
services.xml file</a></h4>

<p>"services.xml" has the configuration for a web Service. Each web service, deployed in Axis2 ,
must have its configuration in "services.xml". The configuration for MyService is as follows:
</p>
<pre>&lt;service &gt;
    &lt;description&gt;
        This is a sample Web service with two operations, echo and ping.
    &lt;/description&gt;
    &lt;parameter name="ServiceClass" locked="false"&gt;userguide.example1.MyService&lt;/parameter&gt;
    &lt;operation name="echo"&gt;
        &lt;messageReceiver class="org.apache.axis2.receivers.RawXMLINOutMessageReceiver"/&gt;
        &lt;actionMapping&gt;urn:echo&lt;/actionMapping&gt;
    &lt;/operation&gt;
     &lt;operation name="ping"&gt;
        &lt;messageReceiver class="org.apache.axis2.receivers.RawXMLINOnlyMessageReceiver"/&gt;
        &lt;actionMapping&gt;urn:ping&lt;/actionMapping&gt;
    &lt;/operation&gt;
 &lt;/service&gt;</pre>

<p><em>The above XML tags can be explained as follows:</em></p>

<p>The description of the service class is provided in the description tag. </p>
<pre>&lt;service &gt;
    &lt;description&gt;
        This is a sample Web service with two operations, echo and ping.
    &lt;/description&gt;
</pre>

<p>The name of the service class is provided as a parameter.
</p>
<pre>&lt;parameter name="serviceClass" locked="false"&gt;userguide.example1.MyService&lt;/parameter&gt;</pre>

<p>The "operation" xml tag describes the operations that are available in this
service with respective message receivers.</p>
<pre>   &lt;operation name="echo"&gt;
            &lt;messageReceiver class="org.apache.axis2.receivers.RawXMLINOutMessageReceiver"/&gt;
            &lt;actionMapping&gt;urn:echo&lt;/actionMapping&gt;
   &lt;/operation&gt;
   &lt;operation name="ping"&gt;
       &lt;messageReceiver class="org.apache.axis2.receivers.RawXMLINOnlyMessageReceiver"/&gt;
       &lt;actionMapping&gt;urn:ping&lt;/actionMapping&gt;
   &lt;/operation&gt;</pre>

<p>Every operation must map to a corresponding MessageReceiver class. 
After a message is processed by the handlers, Axis2 engine hands it over to
a MessageReceiver. <br>
For the "echo" operation, we have used a
<strong>RawXMLINOutMessageReceiver</strong> since it is an IN-OUT operation.
For IN-ONLY operation "ping", we have used
<strong>RawXMLINOnlyMessageReceiver</strong> as the message receiver.</p>

<p>The actionMapping is required only if you want to enable WS-Addressing.
This will be used later in this user guide.</p>

<p>You can write a services.xml file to include a group of services instead
of a single service. This makes management and deployment of a set of related
services very easy. At runtime you can share information between these
services within a single interaction using the ServiceGroupContext. If you
hope to use this functionality, the services.xml file should have the
following format.</p>
<pre>&lt;serviceGroup&gt;
  &lt;service name="Service1"&gt;
    &lt;!-- details for Service1 --&gt;
  &lt;/service&gt;
  &lt;service name="Service2"&gt;
    &lt;!-- details for Service2 --&gt;
  &lt;/service&gt;
  &lt;module ref="ModuleName" /&gt;
  &lt;parameter name="serviceGroupParam1" locked="false"&gt;value 1&lt;/parameter&gt;
&lt;/serviceGroup&gt;</pre>

<p>Note : name of the service is a compulsory attribute. </p>

<h4><a name="Step3_:Create_the_Web_Service_Archive">Step3 :Create the Web
Service Archive</a></h4>

<p>Axis2 uses ".aar" (Axis Archive) file as the deployment package for Web
services. Therefore, for MyService we will use "MyService.aar" with the
"services.xml" packaged in the META-INF in directory structure shown below.
Please note that the name of the archive file will be same as that of the service only if
the services.xml contains only one service element.</p>

<p><img src="images/userguide/ServiceItems.jpg" name="Graphic1"
align="bottom" width="176" height="91" border="0"></p>

<p>To create the archive file, you can create a jar file containing all the necessary files
and then rename it to .aar file.This archive file can be found in the "Axis2Home/samples/userguide" directory. 
This file now has to be deployed. </p>

<h4><a name="Step4_:Deploy_the_Web_Service">Step4 :Deploy the Web
Service</a></h4>

<p>The service can be deployed by dropping dropping the ".aar" file in to
"services" directory in "\webapps\axis2\WEB-INF" of
your servlet container.Start the
servlet container (if you have not already started) and check the link
"Services" on the <a href="http://localhost:8080/axis2/" target="_blank">Home
Page of Axis2 Web Application</a> (http://localhost:8080/axis2) and see
whether the MyService is deployed properly. If you can see the following
output then you have successfully deployed MyService on Axis2. Congratulations !!</p>

<p align="center"><img src="images/userguide/MyServiceDeployed.jpg"
name="Graphic2" align="bottom" border="0"></p>

<p>Note: Axis2 provides an easy way to deploy Web services using the "Upload
Service" tool on Axis2 Web Application's Administration module. Please refer to the <a
href="webadminguide.html" target="_blank">Web Administration Guide</a> for
more information.</p>

<h3><a name="Writing_Web_Services_by_Code_Generating_Skeleton">2. Writing Web
Services by Code Generating Skeleton</a></h3>

<p>This is the second method of writing Web services using Axis2. In this method, 
we generate the skeleton from a given WSDL and implement the business
logic in the classes generated. For this example, we will use Axis2SampleDocLit.wsdl.
This can be found in the <b>wsdl</b> directory under samples.</p>

<h4><a name="How_to_write_the_Web_Service_2">How to write a Web
Service?</a></h4>
This method of writing a Web service with Axis2 involves five steps:
<ol>
  <li><p style="margin-bottom: 0in">Generate the skeleton code</p>
  </li>
  <li><p style="margin-bottom: 0in">Add business logic</p>
  </li>
  <li><p style="margin-bottom: 0in">Verify generated services.xml</p>
  </li>
  <li><p style="margin-bottom: 0in">Create a *.aar archive (Axis Archive) for
    the Web service</p>
  </li>
  <li><p style="margin-bottom: 0in">Deploy the Web service</p>
  </li>
</ol>

<h4><a name="Step1_:Generate_skeleton">Step1 :Generate Skeleton Code</a></h4>

<p>To generate the skeleton and required classes, you can use the
WSDL2Java tool provided in Axis2. This tool is located in the bin directory
of the distribution and can be executed using the provided scripts (.bat or
.sh). The tool's parameter list is as follows and users can specify these
values depending on their requirements.</p>
<pre>Usage WSDL2Code -uri &lt;Location of WSDL&gt; : WSDL file location
-o &lt;output Location&gt; : output file location
-a : Generate async style code only. Default is off
-s : Generate sync style code only. Default is off. takes precedence over -a
-p &lt;package name&gt; : set custom package name
-l &lt;language&gt; : valid languages are java and csharp. Default is java
-t : Generate TestCase to test the generated code
-ss : Generate server side code (i.e. skeletons). Default is off
-sd : Generate service descriptor (i.e. services.xml). Default is off. Valid with -ss
-d &lt;databinding&gt; : valid databinding(s) are adb, xmlbeans and jaxme. Default is adb
-g Generates all the classes. valid only with the -ss
-pn &lt;port_name&gt; : name of port in the presence of multiple ports
-sn &lt;service_name&gt; : name of service in the presence of multiple services
-u : unpacks the databinding classes
-r &lt;repository_path&gt; : path of the repository against which code is generated</pre>

<p>The parameters for wsdl2java tool in our example are as follows:</p>

<h5> Windows </h5>

<!--<p>Windows users can use the following command in the console:</p> -->
<pre style="margin-bottom: 0.2in">WSDL2Java.bat -uri ..\samples\wsdl\Axis2SampleDocLit.wsdl -ss -sd -d xmlbeans -o ..\samples -p org.apache.axis2.userguide</pre>

<h5> Linux </h5>
<!--<p>Linux users should switch the file separator:</p> -->
<pre style="margin-bottom: 0.2in">WSDL2Java.sh -uri ../samples/wsdl/Axis2SampleDocLit.wsdl -ss -sd -d xmlbeans -o ../samples -p org.apache.axis2.userguide</pre>

<p>This will generate the required classes in the <b>src</b> directory inside
samples, and the schema classes in <strong>schemaorg_apache_xmlbeans</strong>
directory which is inside resources directory and also inside samples
dir<strong></strong>. Note that these are not source files and should be
available in the class path in order to compile the generated classes.</p>

<h4><a name="Step2_Implement_Business_Logic">Step 2: Implement Business
Logic</a></h4>

<p>Implement the business logic in the skeleton class. 
The skeleton class "Axis2SampleDocLitServiceSkeleton.java" can be found in
src/org/apache/axis2/userguide directory. Our sample WSDL has
three operations: <!--<li><p style="margin-bottom: 0in">echoVoid  - Operation that does not
accept any input parameters  and also provide no out put parameters. Just
perform some task </p>
</li>-->
</p>
<ul>
  <li><p style="margin-bottom: 0in">echoString  - echoes a String value </p>
  </li>
  <li><p style="margin-bottom: 0in">echoStringArray - echoes a String Array</p>
  </li>
  <li><p style="margin-bottom: 0in">echoStruct - echoes a Struct</p>
  </li>
</ul>
<!--<h4>echoVoid   </h4>

<p>Locate the following code segment  in 
"Axis2SampleDocLitServiceSkeleton.java"  and add the business logic. For
the explanation purpose we do not need anything to be implemented here.</p>
<pre>public  void echoVoid(){
//Todo fill this with the necessary business logic
}</pre> -->

<h4><a name="echoString">echoString</a></h4>

<p>Locate the following code segment  in "Axis2SampleDocLitServiceSkeleton.java"  
and add the business logic as shown
below.</p>
<pre> public org.apache.axis2.userguide.xsd.EchoStringReturnDocument echoString
   (org.apache.axis2.userguide.xsd.EchoStringParamDocument param4 ){
      //Todo fill this with the necessary business logic
      throw new  java.lang.UnsupportedOperationException();
   }
 </pre>

<p>Once the business logic is added, the source code appears as below:
</p>
<pre>public org.apache.axis2.userguide.xsd.EchoStringReturnDocument echoString
   (org.apache.axis2.userguide.xsd.EchoStringParamDocument param4) throws Exception {
   //Use the factory to create the output document.
   EchoStringReturnDocument retDoc = EchoStringReturnDocument.Factory.newInstance();
   //send the string back.
   retDoc.setEchoStringReturn(param4.getEchoStringParam());
   return retDoc;
 }</pre>



<h4><a name="echoStringArray">echoStringArray</a></h4>

<p>The code segment for echoStringArray is shown below:</p>

<pre>public org.apache.axis2.userguide.xsd.EchoStringArrayReturnDocument echoStringArray
   (org.apache.axis2.userguide.xsd.EchoStringArrayParamDocument param0) throws Exception {
   //Use the factory to create the output document.
   EchoStringArrayReturnDocument retDoc = EchoStringArrayReturnDocument.Factory.newInstance();
   //Get the String array from the input parameters.
   String[] inParams = param0.getEchoStringArrayParam().getStringArray();
   ArrayOfstringLiteral retParams = ArrayOfstringLiteral.Factory.newInstance();
   //Set the input parameters to the output parameters for echoing.
     for (int i = 0; i &lt; inParams.length; i++) {
        retParams.addString(inParams[i]);
     }
   //return the output document.
   retDoc.setEchoStringArrayReturn(retParams);
   return retDoc;
}</pre>

<h4><a name="echoStruct">echoStruct</a></h4>

<p>The code segment for echoStruct is shown below:</p>

<pre>public org.apache.axis2.userguide.xsd.EchoStructReturnDocument echoStruct
     (org.apache.axis2.userguide.xsd.EchoStructParamDocument param2) throws Exception {
     //Use the factory to create the output document.
     EchoStructReturnDocument retDoc = EchoStructReturnDocument.Factory.newInstance();

     //Get the SOAPStrcut from the incoming parameters
     SOAPStruct inStruct = param2.getEchoStructParam();

     //Struct for the sending back
     SOAPStruct outStruct = SOAPStruct.Factory.newInstance();

     //Fill the outgoing struct
     outStruct.setVarFloat(inStruct.getVarFloat());
     outStruct.setVarInt(inStruct.getVarInt());
     outStruct.setVarString(inStruct.getVarString());
     //Set the outgoing document.
     retDoc.setEchoStructReturn(outStruct);

     return retDoc;
}</pre>


<h4><a name="Step3_:Verify_services_xml">Step3 :Verify generated services.xml</a></h4>

<p> As mentioned earlier, "services.xml" file holds all the configuration informatinn for 
for a webservice. When the skeleton is generated using the WSDL2Java tool, 
the services.xml file is also generated. This file can be found in the same directory as the 
skeleton. The generated services.xml is as follows.</p>
<pre>&lt;!-- This file was auto-generated from WSDL --&gt;
&lt;!-- by the Apache Axis2 version: #axisVersion# #today# --&gt;
&lt;serviceGroup&gt;
  &lt;service name="Axis2SampleDocLitService"&gt;
   &lt;messageReceivers&gt;
      &lt;messageReceiver mep="http://www.w3.org/2004/08/wsdl/in-out" 
      class="org.apache.axis2.userguide.Axis2SampleDocLitServiceMessageReceiverInOut"/&gt;
   &lt;/messageReceivers&gt;
   &lt;parameter locked="false" name="ServiceClass"&gt;
   org.apache.axis2.userguide.Axis2SampleDocLitServiceSkeleton&lt;/parameter&gt;
   &lt;operation name="echoStringArray" mep="http://www.w3.org/2004/08/wsdl/in-out"&gt;
      &lt;actionMapping&gt;echoStringArray&lt;/actionMapping&gt;
   &lt;/operation&gt;
   &lt;operation name="echoStruct" mep="http://www.w3.org/2004/08/wsdl/in-out"&gt;
      &lt;actionMapping&gt;echoStruct&lt;/actionMapping&gt;
   &lt;/operation&gt;
   &lt;operation name="echoString" mep="http://www.w3.org/2004/08/wsdl/in-out"&gt;
      &lt;actionMapping&gt;echoString&lt;/actionMapping&gt;
   &lt;/operation&gt;
  &lt;/service&gt;
&lt;/serviceGroup&gt;</pre>

<p>First line of the "services.xml" gives the name of the Web service. This
is used in the URL to the service as the service name. Next comes the
description and the service class. The following xml tags describe the
operations that are available in this service with respective message
receivers.</p>

<h4><a name="Step4_Create_archive">Step 4: Create Archive file</a></h4>

<p>The next step is to package the classes in an .aar (axis2
archive) and deploy it in Axis2. When the WSDL2Java tool generates the
skeleton, it will also generate the required data binding classes. These
schema related classes are located in the
<strong>schemaorg_apache_xmlbeans</strong> directory inside resources
directory of the generated code. Copy this to your class path, compile the
skeleton and the supporting classes. To create the .aar file, create the following 
directory structure with the required files and then jar it up.2:45 PM 9/28/2006</p>

<p><img src="images/userguide/DirectoryStructure.jpg" align="bottom"
border="0"></p>

<p>Go to the top level directory where you can find the class files for the
above service (i.e. one level up on the directory structure shown above),
then run the following on the command line</p>
<pre style="margin-bottom: 0.2in">jar -cf Axis2SampleDocLitService.aar .</pre>

<h4><a name="Step5_Deploy_web_service">Step 5: Deploy Web Service</a></h4>

<p>The service can be deployed by dropping dropping the ".aar" file in to
"services" directory in "\webapps\axis2\WEB-INF" of
your servlet container.Start the
servlet container (if you have not already started) and check the link
"Services" on the <a href="http://localhost:8080/axis2/" target="_blank">Home
Page of Axis2 Web Application</a> (http://localhost:8080/axis2) and see
whether the Axis2SampleDocLitService is deployed properly. If you can see the following
output then you have successfully deployed Axis2SampleDocLitService on Axis2. Congratulations !!</p>

<p align="center"><img src="images/userguide/ServiceDeployed.jpg"
name="Graphic4" align="bottom" border="0"></p>

<p>Note: Axis2 provides an easy way to deploy Web Services using the "Upload
Service" tool on Axis2 Web Application's Administration module. (See the <a
href="webadminguide.html" target="_blank">Web Administration Guide</a> for
more information on this)</p>

<p align="right"><a href="userguide1.html"><img src="images/arrow_left.gif">
Previous</a> | <a href="userguide3.html">Next <img
src="images/arrow_right.gif"></a></p>

<p>Pages: <a href="userguide.html">Content</a>, <a
href="userguide1.html">1</a>, <b>2</b>, <a href="userguide3.html">3</a>, <a
href="userguide4.html">4</a>, <a href="userguide5.html">5</a></p>
</body>
</html>
